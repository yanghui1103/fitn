<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="systemSql">
	<cache  eviction="FIFO"  flushInterval="60000"  size="1024"  readOnly="true"/>
	<!-- 获取用户信息 -->
	<select id="getStaffInfoById"  parameterType="commonModel"
		resultType="staff">
		 select a.*,(select staff_name from staff where fdid = a.creator) creator_name,
 		(select company_name from company where fdid = a.create_company_id) create_company_name,
     (select company_name from company cp ,staff2company scc where cp.fdid = scc.company_id and scc.staff_id = a.fdid) company_name,
     (select fdid from company cp ,staff2company scc where cp.fdid = scc.company_id and scc.staff_id = a.fdid) company_id
  		 from  staff  a where a.fdid = #{fdid}
	</select>
	<select id="getStaffInfoByNumber"  parameterType="commonModel"
		resultType="staff">
		 select a.*,(select staff_name from staff aa where aa.fdid = a.creator) creator_name,
     (select company_name from company where fdid = a.create_company_id) create_company_name,
     (select company_name from company cp ,staff2company scc where cp.fdid = scc.company_id and scc.staff_id = a.fdid) company_name,
     (select fdid from company cp ,staff2company scc where cp.fdid = scc.company_id and scc.staff_id = a.fdid) company_id
       from   staff  a  where a.staff_number =#{staff_number} and isdeleted='0'
	</select>
	<select id="getRoleListByStaffId" parameterType="commonModel"
		resultType="postion">
	 	select a.fdid,a.role_name,a.parent_id from  roles a,staff2role sl  where 1=1
    	and a.fdid = sl.role_id and sl.staff_id = #{fdid} 
	</select>
	<select id="getPostionListByStaffId" parameterType="commonModel"
		resultType="postion">
	 	select a.fdid,a.postion_name,a.desp from  postion a,staff2postion sp  where 1=1
		and a.fdid = sp.postion_id and sp.staff_id = #{fdid} 
	</select>
	<!-- 获取用户直接关联的菜单 -->
	<select id="getMenuOfStaff"  parameterType="commonModel"
		resultType="commonModel">
	select mm.*
 	from  staff2authority sa,authority au ,authority2menu am ,menu mm 
	where 1=1 and sa.authority_id = au.fdid and au.fdid = am.authority  and am.menu_id = mm.fdid
	and au.isdeleted = mm.isdeleted  and mm.isdeleted ='0' and sa.staff_id = #{fdid}
	</select>
	<!-- 获取用户与角色直接关联的菜单 -->
	<select id="getMenuOfStaffRole" parameterType="commonModel"
		resultType="commonModel">
	select mm.* from  staff2role sr,roles rl ,role2authority ra,authority au ,authority2menu am ,menu mm
	where 1=1 and sr.role_id = rl.fdid and rl.fdid = ra.role_id and ra.authority_id = au.fdid
 	and au.fdid = am.authority and am.menu_id = mm.fdid and mm.isdeleted = au.isdeleted 
 	and mm.isdeleted = rl.isdeleted  and rl.isdeleted ='0'  
 	and sr.staff_id = #{fdid} 
	</select>
	<!-- 获取用户组与角色关联的菜单 -->
	<select id="getMenuOfStaffGrp" parameterType="commonModel"
		resultType="commonModel">
	select mm.* from  staff2group sg ,staff_group sgg,role2group rg,roles rl ,role2authority ra,authority au,authority2menu am ,menu mm
	where sg.staff_id = sgg.fdid and sgg.fdid = rg.group_id and rg.role_id = ra.role_id and ra.authority_id = au.fdid and au.fdid = am.authority
	and am.menu_id = mm.fdid and mm.isdeleted = au.isdeleted and mm.isdeleted = rl.isdeleted and rl.isdeleted = sgg.isdeleted and sgg.isdeleted ='0'
	and sg.staff_id=#{fdid}
	</select>
	<!-- 更改密码 -->
	<update id="updatePwd" parameterType="commonModel">
	update staff set password = #{temp_str3}  where fdid = #{fdid}
	</update>
	<!-- 所有子组织 -->
	<select id="getChildCompByCurrentComp" parameterType="String"
		resultType="commonModel">
	 select a.*
    from company a 
    where isdeleted='0'
  	connect by a.parent_id = prior a.fdid
   	start with a.parent_id =#{fdid}
	</select>
	<!-- 所有子组织,包含自己组织 -->
	<select id="getChildCompsByThisComp" parameterType="String"
		resultType="commonModel">
	 select a.*
    from company a 
    where isdeleted='0'
  	connect by a.parent_id = prior a.fdid
   	start with a.parent_id =#{fdid}
   	union
   	select * from company where fdid = #{fdid}
	</select>
	<!-- 获取组织列表 -->
	<select id="getCompanyList" parameterType="commonModel"
		resultType="commonModel">
	select a.*,(select company_name from company aa where aa.fdid = a.parent_id) parent_company_name 
	from  company  a where a.isdeleted='0' and a.fdid in 	
  			<foreach item="item" index="index" collection="temp_list" open="(" separator="," close=")">  
  					#{item}  
 			</foreach>   
	</select>
	<!-- 根据菜单查询出页面上的按钮 -->
	
</mapper>   